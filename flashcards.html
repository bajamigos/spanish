<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Antonimo Flashcards</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 20px;
            position: relative;
            min-height: 100vh;
            background-color: white;
            overflow-x: hidden;
        }
        .logo-bg {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 600px;
            opacity: 0.25;
            z-index: -1;
            pointer-events: none;
        }
        @media (max-width: 800px) {
            .logo-bg {
                width: 80vw;
                opacity: 0.3;
            }
        }
        #flashcard {
            max-width: 600px;
            margin: 40px auto;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        #front {
            font-size: 1.2em;
        }
        .hint { font-size: 1em; color: #666; }
        .above-hint { margin-bottom: 20px; }
        .below-hint { margin-top: 20px; }
        #card-num { font-size: 0.8em; color: #999; }
        button {
            padding: 10px 20px;
            margin: 10px;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            border-radius: 4px;
        }
        #buttons {
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>
    <h1>Flashcards v.2025.10.25</h1>
    <p id="learned">Learned cards: 0</p>
    <div id="flashcard">
        <div id="card-num"></div>
        <div id="front"></div>
    </div>
    <div id="buttons">
        <button id="flipBtn" onclick="flip()">Show Answer</button>
        <div id="rate" style="display:none;">
            <button onclick="rate(false)">Incorrect</button>
            <button onclick="rate(true)">Correct</button>
        </div>
    </div>
    <img src="antonimo-logo.jpg" alt="Antonimo logo" class="logo-bg">
    <script>
        let scales = {};
        let cards = [];
        let srsData = JSON.parse(localStorage.getItem('srsData')) || [];
        let activeIds = JSON.parse(localStorage.getItem('activeIds')) || [];
        let currentId;
        let flipped = false;

        async function loadData() {
            const response = await fetch('flashcard-data.csv');
            const csvText = await response.text();
            const lines = csvText.trim().split('\n').slice(1);
            const data = lines.map(line => {
                const [pair, pos, hint, gradtype, orderStr, word, sentencesStr] = line.split(',');
                const order = parseInt(orderStr);
                const sentences = sentencesStr ? sentencesStr.split('|') : [];
                return {pair, pos, hint, gradtype, order, word, sentences};
            });
            data.forEach(d => {
                if (!scales[d.pair]) scales[d.pair] = [];
                scales[d.pair].push({order: d.order, word: d.word});
                d.sentences.forEach(sent => {
                    cards.push({front: sent, back: d.word, pair: d.pair, order: d.order});
                });
            });
            for (let p in scales) {
                scales[p].sort((a, b) => a.order - b.order);
                scales[p] = scales[p].map(w => w.word);
            }
            srsData = JSON.parse(localStorage.getItem('srsData')) || Array(cards.length).fill().map(() => ({streak: 0, learnedTime: 0}));
            activeIds = JSON.parse(localStorage.getItem('activeIds')) || Array.from({length: Math.min(10, cards.length)}, (_, i) => i);
            activeIds = activeIds.filter(id => id < cards.length && srsData[id].learnedTime === 0);
            while (activeIds.length < 10 && activeIds.length < cards.length) {
                let nextId = Math.max(-1, ...activeIds) + 1;
                if (nextId >= cards.length) break;
                activeIds.push(nextId);
            }
            if (activeIds.length > 0) {
                currentId = activeIds[Math.floor(Math.random() * activeIds.length)];
            }
            updateLearned();
            if (activeIds.length > 0) showCard();
        }

        function save() {
            localStorage.setItem('srsData', JSON.stringify(srsData));
            localStorage.setItem('activeIds', JSON.stringify(activeIds));
        }

        function updateLearned() {
            const now = Date.now();
            const day = 24 * 60 * 60 * 1000;
            const count = srsData.filter(d => d.learnedTime > now - day).length;
            document.getElementById('learned').textContent = `Learned cards: ${count}/${cards.length}`;
        }

        function showCard() {
            if (!cards[currentId]) return;
            const card = cards[currentId];
            const this_scale = scales[card.pair];
            const index = card.order;
            const lower = index > 0 ? this_scale[index - 1] : '';
            const higher = index < this_scale.length - 1 ? this_scale[index + 1] : '';
            let frontHtml = '';
            if (higher) frontHtml += `<div class="hint above-hint">${higher}</div>`;
            let sentence = card.front;
            if (flipped) {
                sentence = sentence.replace('_____', `<strong style="color: green;">${card.back}</strong>`);
            }
            frontHtml += sentence;
            if (lower) frontHtml += `<div class="hint below-hint">${lower}</div>`;
            document.getElementById('card-num').textContent = `Card ${currentId + 1}`;
            document.getElementById('front').innerHTML = frontHtml;
            document.getElementById('flipBtn').style.display = flipped ? 'none' : 'block';
            document.getElementById('rate').style.display = flipped ? 'block' : 'none';
        }

        function flip() {
            flipped = true;
            showCard();
        }

        function rate(correct) {
            if (correct) {
                srsData[currentId].streak++;
                if (srsData[currentId].streak === 3) {
                    srsData[currentId].learnedTime = Date.now();
                    activeIds = activeIds.filter(id => id !== currentId);
                    let nextId = Math.max(-1, ...activeIds) + 1;
                    if (nextId < cards.length) {
                        activeIds.push(nextId);
                    }
                }
            } else {
                srsData[currentId].streak = 0;
            }
            save();
            updateLearned();
            flipped = false;
            if (activeIds.length === 0) {
                alert('All cards learned!');
                return;
            }
            currentId = activeIds[Math.floor(Math.random() * activeIds.length)];
            showCard();
        }

        loadData();
    </script>
</body>
</html>
